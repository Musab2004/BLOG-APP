<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Editor</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
rel="stylesheet"
/>
<!-- Google Fonts -->
<link
href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
rel="stylesheet"
/>
<!-- MDB -->
<link
href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css"
rel="stylesheet"
/>
</head>
<body>
    <!-- <script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.js"
></script> -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> -->

</head>

<header>
    <!-- Intro settings -->

    <!-- Navbar -->
   {% include 'navbar.html' %}


    <!-- Navbar -->
  
    <!-- Jumbotron -->

    <!-- Jumbotron -->
  </header>

  <script>
    $(document).ready(function() {
      // Trigger file input click when the user clicks on the image
      const myButton = document.getElementById('previewImage');
      const Inputimage = document.getElementById('imageInput');
  // Add a click event listener to the element
  myButton.addEventListener('click', function() {
      const my= document.getElementById('imageInput');
      my.click()
  
  });
  Inputimage.addEventListener('change', function() {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      const previewImage = document.getElementById('previewImage');
      previewImage.src = e.target.result;
      previewImage.style.display = 'block';
      previewImage.style.marginLeft = '30%';
      console.log("its running")
    };
  reader.readAsDataURL(file);
      // Function to read and display the selected image
  
    });
  });
  </script>
<body>
    {% if messages %}
   <div class="container fixed-top" style="margin-top: 5%">
      {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert" id="message_box">
          {{ message }}
        
      </div>
      {% endfor %}
   </div>
   {% endif %}
   <script>
    var message_tag = document.getElementById("message_box");
    
    setTimeout(function(){ 
       message_tag.style.display = "none"; 
    }, 3000);    
    
    </script>


<div style="margin-top: 10%; width: 80%; margin-left: 10%;">   
    <form method="post" id="blogForm" action="{% url 'blog_home:writeblog' %}"  enctype="multipart/form-data">
        <form method="post" id="blogForm" action="{% url 'blog_home:writeblog' %}" enctype="multipart/form-data">

            <div class="form-group">
              <div class="image-container text-center">
                <!-- Placeholder image -->
          
                <div>
                <img src="https://mdbootstrap.com/img/new/slides/080.jpg" id="previewImage" class="img-fluid" alt="Uploaded Image" style="border-radius: 2%; height: 200px; width: 40%;">
                  
            </div>
            <!-- <label for="imageInput">Image is required</label> -->
                <!-- File input -->
                <input type="file" id="imageInput" name="blog_title_image" class="d-none" >
              </div>
              <b style="font-size: 20px;margin-top: 1%;">Blog title : </b>
              <input type="text" class="form-control" id="blogTitle" name="blogTitle" placeholder="Enter your blog title" required>
              <b style="font-size: 20px;margin-top: 1%;">Blog Description  : </b>
              <input type="text" class="form-control" id="description" name="description" placeholder="Enter description of your blog" required>
              <b style="font-size: 20px;margin-top: 1%;" >Blog Category : </b>
              <input type="text" class="form-control" id="category"  name="Category" placeholder="Category" required>
          
            </div>
            <b style="font-size: 20px;">Blog Content : </b>
            <div id="editor"></div>
            <input type="hidden" id="hiddenContent" name="hiddenContent">
            {% csrf_token %}
            <button type="submit" id="saveButton" class="btn btn-primary" style="margin-top: 5%;margin-left: 20%; width: 50%;background-color:  #000F1F;color: lightgrey;font-weight: bold; ">Save</button>
          </form>
      
</div>
    
       <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
var quill = new Quill('#editor', {
    modules: {
        toolbar: [
            [{ header: [1, 2, false] }],
            ['bold', 'italic', 'underline', 'link'],
            [{ list: 'ordered' }, { list: 'bullet' }],
            ['image']
        ]
    },
    placeholder: 'Do some stuff here',
    theme: 'snow'
});

quill.getModule('toolbar').addHandler('image', function() {
    var input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', 'image/*');
    input.click();

    input.onchange = function() {
        var file = input.files[0];
        if (file) {
            var formData = new FormData();
            formData.append('image', file);

            fetch('{% url "blog_home:uploadimage" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    // 'X-CSRFToken': 'your-csrf-token',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.url) {
                    var range = quill.getSelection();
                    quill.insertEmbed(range.index, 'image', data.url);
                    var hiddenContentInput = document.getElementById('hiddenContent');
                    hiddenContentInput.value=quill.root.innerHTML
                    console.log(quill.root.innerHTML)
                } else {
                    console.error('Image upload failed.');
                }
            })
            .catch(error => {
                console.error('Error uploading image:', error);
            });
        }
    };
});

  </script>
</body>
</html>
